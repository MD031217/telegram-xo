<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Крестики-нолики 5 в ряд</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .game-container {
            display: inline-block;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .game-info {
            margin-bottom: 15px;
            font-size: 18px;
            color: #555;
        }
        
        .game-board {
            position: relative;
            overflow: auto;
            max-width: 90vw;
            max-height: 70vh;
            border: 2px solid #333;
            margin: 0 auto;
        }
        
        .cell {
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            display: inline-block;
            box-sizing: border-box;
            vertical-align: top;
            position: relative;
            cursor: pointer;
            background-color: #fff;
        }
        
        .cell:hover {
            background-color: #f9f9f9;
        }
        
        .x::before, .x::after {
            content: '';
            position: absolute;
            width: 80%;
            height: 4px;
            background-color: #e74c3c;
            top: 50%;
            left: 10%;
        }
        
        .x::before {
            transform: translateY(-50%) rotate(45deg);
        }
        
        .x::after {
            transform: translateY(-50%) rotate(-45deg);
        }
        
        .o::before {
            content: '';
            position: absolute;
            width: 70%;
            height: 70%;
            border: 4px solid #3498db;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .controls {
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
        }
        
        button:hover {
            background-color: #27ae60;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .win-message {
            font-size: 24px;
            font-weight: bold;
            margin-top: 15px;
            color: #e74c3c;
        }
        
        .coordinates {
            font-size: 12px;
            color: #999;
            position: absolute;
            bottom: 2px;
            right: 2px;
        }
    </style>
</head>
<body>
    <h1>Крестики-нолики 5 в ряд</h1>
    
    <div class="game-container">
        <div class="game-info">
            <span id="status">Ваш ход (X)</span>
        </div>
        
        <div class="game-board" id="gameBoard">
            <!-- Игровое поле будет генерироваться здесь -->
        </div>
        
        <div class="controls">
            <button id="resetBtn">Новая игра</button>
            <button id="botMoveBtn">Ход бота</button>
        </div>
        
        <div id="winMessage" class="win-message"></div>
    </div>

    <script>
        // Конфигурация игры
        const CONFIG = {
            WIN_LENGTH: 5, // Количество символов для победы
            CELL_SIZE: 40,  // Размер ячейки в пикселях
            BOARD_SIZE: 15  // Начальный размер поля (будет расширяться)
        };

        // Состояние игры
        let gameState = {
            board: {}, // Хранит состояние клеток в формате { "x,y": "x" или "o" }
            currentPlayer: 'x', // Текущий игрок (x - человек, o - бот)
            gameOver: false,
            minX: 0,
            maxX: 0,
            minY: 0,
            maxY: 0
        };

        // Элементы DOM
        const gameBoard = document.getElementById('gameBoard');
        const statusElement = document.getElementById('status');
        const winMessageElement = document.getElementById('winMessage');
        const resetBtn = document.getElementById('resetBtn');
        const botMoveBtn = document.getElementById('botMoveBtn');

        // Инициализация игры
        function initGame() {
            gameState = {
                board: {},
                currentPlayer: 'x',
                gameOver: false,
                minX: -Math.floor(CONFIG.BOARD_SIZE / 2),
                maxX: Math.floor(CONFIG.BOARD_SIZE / 2),
                minY: -Math.floor(CONFIG.BOARD_SIZE / 2),
                maxY: Math.floor(CONFIG.BOARD_SIZE / 2)
            };
            
            winMessageElement.textContent = '';
            statusElement.textContent = 'Ваш ход (X)';
            renderBoard();
        }

        // Отрисовка игрового поля
        function renderBoard() {
            gameBoard.innerHTML = '';
            
            // Создаем таблицу для отображения координат
            const table = document.createElement('table');
            table.style.borderCollapse = 'collapse';
            
            // Создаем заголовки для осей
            const headerRow = document.createElement('tr');
            const emptyHeader = document.createElement('th');
            headerRow.appendChild(emptyHeader);
            
            for (let x = gameState.minX; x <= gameState.maxX; x++) {
                const th = document.createElement('th');
                th.textContent = x;
                th.style.width = `${CONFIG.CELL_SIZE}px`;
                th.style.height = `${CONFIG.CELL_SIZE}px`;
                headerRow.appendChild(th);
            }
            table.appendChild(headerRow);
            
            // Создаем строки с координатами и клетками
            for (let y = gameState.minY; y <= gameState.maxY; y++) {
                const row = document.createElement('tr');
                
                // Добавляем координату Y
                const yCoord = document.createElement('td');
                yCoord.textContent = y;
                yCoord.style.textAlign = 'center';
                yCoord.style.fontWeight = 'bold';
                row.appendChild(yCoord);
                
                // Добавляем клетки для этой строки
                for (let x = gameState.minX; x <= gameState.maxX; x++) {
                    const cell = document.createElement('td');
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    
                    // Отображаем содержимое клетки
                    const key = `${x},${y}`;
                    if (gameState.board[key]) {
                        cell.classList.add(gameState.board[key]);
                    }
                    
                    // Добавляем обработчик клика
                    cell.addEventListener('click', () => makeMove(x, y));
                    
                    row.appendChild(cell);
                }
                
                table.appendChild(row);
            }
            
            gameBoard.appendChild(table);
        }

        // Выполнение хода
        function makeMove(x, y) {
            if (gameState.gameOver || gameState.currentPlayer !== 'x') return;
            
            const key = `${x},${y}`;
            if (gameState.board[key]) return; // Клетка уже занята
            
            // Выполняем ход
            gameState.board[key] = 'x';
            
            // Проверяем победу
            if (checkWin(x, y, 'x')) {
                gameState.gameOver = true;
                winMessageElement.textContent = 'Вы победили!';
                statusElement.textContent = 'Игра окончена';
                return;
            }
            
            // Проверяем ничью
            if (isBoardFull()) {
                gameState.gameOver = true;
                winMessageElement.textContent = 'Ничья!';
                statusElement.textContent = 'Игра окончена';
                return;
            }
            
            // Передаем ход боту
            gameState.currentPlayer = 'o';
            statusElement.textContent = 'Ход бота (O)...';
            
            // Даем боту время на "обдумывание"
            setTimeout(makeBotMove, 500);
        }

        // Ход бота
        function makeBotMove() {
            if (gameState.gameOver) return;
            
            const move = findBestMove();
            if (move) {
                const { x, y } = move;
                const key = `${x},${y}`;
                gameState.board[key] = 'o';
                
                // Обновляем границы поля при необходимости
                updateBoardBounds(x, y);
                
                // Проверяем победу
                if (checkWin(x, y, 'o')) {
                    gameState.gameOver = true;
                    winMessageElement.textContent = 'Бот победил!';
                    statusElement.textContent = 'Игра окончена';
                    renderBoard();
                    return;
                }
                
                // Проверяем ничью
                if (isBoardFull()) {
                    gameState.gameOver = true;
                    winMessageElement.textContent = 'Ничья!';
                    statusElement.textContent = 'Игра окончена';
                    renderBoard();
                    return;
                }
                
                // Передаем ход человеку
                gameState.currentPlayer = 'x';
                statusElement.textContent = 'Ваш ход (X)';
                renderBoard();
            }
        }

        // Алгоритм поиска лучшего хода для бота
        function findBestMove() {
            // Сначала проверяем, можем ли мы выиграть следующим ходом
            for (let y = gameState.minY; y <= gameState.maxY; y++) {
                for (let x = gameState.minX; x <= gameState.maxX; x++) {
                    const key = `${x},${y}`;
                    if (!gameState.board[key]) {
                        // Проверяем, приведет ли этот ход к победе
                        gameState.board[key] = 'o';
                        if (checkWin(x, y, 'o')) {
                            gameState.board[key] = undefined;
                            return { x, y };
                        }
                        gameState.board[key] = undefined;
                    }
                }
            }
            
            // Затем блокируем выигрышные ходы противника
            for (let y = gameState.minY; y <= gameState.maxY; y++) {
                for (let x = gameState.minX; x <= gameState.maxX; x++) {
                    const key = `${x},${y}`;
                    if (!gameState.board[key]) {
                        gameState.board[key] = 'x';
                        if (checkWin(x, y, 'x')) {
                            gameState.board[key] = undefined;
                            return { x, y };
                        }
                        gameState.board[key] = undefined;
                    }
                }
            }
            
            // Ищем лучшую позицию для атаки или защиты
            let bestScore = -Infinity;
            let bestMove = null;
            
            // Оцениваем все возможные ходы
            for (let y = gameState.minY; y <= gameState.maxY; y++) {
                for (let x = gameState.minX; x <= gameState.maxX; x++) {
                    const key = `${x},${y}`;
                    if (!gameState.board[key]) {
                        const score = evaluatePosition(x, y, 'o');
                        if (score > bestScore) {
                            bestScore = score;
                            bestMove = { x, y };
                        }
                    }
                }
            }
            
            // Если не нашли хороший ход, расширяем поле
            if (!bestMove) {
                // Находим занятые клетки и расширяем поле вокруг них
                const occupiedCells = Object.keys(gameState.board).map(key => {
                    const [x, y] = key.split(',').map(Number);
                    return { x, y };
                });
                
                if (occupiedCells.length > 0) {
                    // Выбираем случайную занятую клетку
                    const randomCell = occupiedCells[Math.floor(Math.random() * occupiedCells.length)];
                    
                    // Находим свободную клетку рядом
                    const directions = [
                        { dx: 1, dy: 0 }, { dx: -1, dy: 0 },
                        { dx: 0, dy: 1 }, { dx: 0, dy: -1 },
                        { dx: 1, dy: 1 }, { dx: -1, dy: -1 },
                        { dx: 1, dy: -1 }, { dx: -1, dy: 1 }
                    ];
                    
                    for (const dir of directions) {
                        const newX = randomCell.x + dir.dx;
                        const newY = randomCell.y + dir.dy;
                        const key = `${newX},${newY}`;
                        
                        if (!gameState.board[key]) {
                            return { x: newX, y: newY };
                        }
                    }
                }
                
                // Если все еще не нашли ход, возвращаем случайную клетку в центре
                return { x: 0, y: 0 };
            }
            
            return bestMove;
        }

        // Оценка позиции для алгоритма бота
        function evaluatePosition(x, y, player) {
            let score = 0;
            
            // Проверяем все направления
            const directions = [
                { dx: 1, dy: 0 },   // Горизонталь
                { dx: 0, dy: 1 },   // Вертикаль
                { dx: 1, dy: 1 },   // Диагональ \
                { dx: 1, dy: -1 }   // Диагональ /
            ];
            
            for (const dir of directions) {
                // Проверяем линию в обе стороны от текущей позиции
                let lineLength = 1; // Текущая клетка уже считается
                
                // Проверяем в положительном направлении
                for (let i = 1; i < CONFIG.WIN_LENGTH; i++) {
                    const checkX = x + dir.dx * i;
                    const checkY = y + dir.dy * i;
                    const key = `${checkX},${checkY}`;
                    
                    if (gameState.board[key] === player) {
                        lineLength++;
                    } else if (gameState.board[key]) {
                        // Встретили чужую фигуру - прерываем линию
                        break;
                    } else {
                        // Свободная клетка - продолжаем
                    }
                }
                
                // Проверяем в отрицательном направлении
                for (let i = 1; i < CONFIG.WIN_LENGTH; i++) {
                    const checkX = x - dir.dx * i;
                    const checkY = y - dir.dy * i;
                    const key = `${checkX},${checkY}`;
                    
                    if (gameState.board[key] === player) {
                        lineLength++;
                    } else if (gameState.board[key]) {
                        // Встретили чужую фигуру - прерываем линию
                        break;
                    } else {
                        // Свободная клетка - продолжаем
                    }
                }
                
                // Оцениваем длину линии
                if (lineLength >= CONFIG.WIN_LENGTH) {
                    score += 1000; // Победа
                } else if (lineLength === CONFIG.WIN_LENGTH - 1) {
                    score += 100; // Почти победа
                } else if (lineLength === CONFIG.WIN_LENGTH - 2) {
                    score += 10; // Хорошая позиция
                } else {
                    score += lineLength; // Просто добавляем длину
                }
            }
            
            return score;
        }

        // Проверка победы
        function checkWin(x, y, player) {
            // Проверяем все направления
            const directions = [
                { dx: 1, dy: 0 },   // Горизонталь
                { dx: 0, dy: 1 },   // Вертикаль
                { dx: 1, dy: 1 },   // Диагональ \
                { dx: 1, dy: -1 }   // Диагональ /
            ];
            
            for (const dir of directions) {
                let count = 1; // Текущая клетка уже считается
                
                // Проверяем в положительном направлении
                for (let i = 1; i < CONFIG.WIN_LENGTH; i++) {
                    const checkX = x + dir.dx * i;
                    const checkY = y + dir.dy * i;
                    const key = `${checkX},${checkY}`;
                    
                    if (gameState.board[key] === player) {
                        count++;
                    } else {
                        break;
                    }
                }
                
                // Проверяем в отрицательном направлении
                for (let i = 1; i < CONFIG.WIN_LENGTH; i++) {
                    const checkX = x - dir.dx * i;
                    const checkY = y - dir.dy * i;
                    const key = `${checkX},${checkY}`;
                    
                    if (gameState.board[key] === player) {
                        count++;
                    } else {
                        break;
                    }
                }
                
                if (count >= CONFIG.WIN_LENGTH) {
                    return true;
                }
            }
            
            return false;
        }

        // Проверка на ничью (все поле заполнено)
        function isBoardFull() {
            // В бесконечном поле ничья невозможна, но мы можем ограничить проверку текущей видимой областью
            const totalCells = (gameState.maxX - gameState.minX + 1) * (gameState.maxY - gameState.minY + 1);
            const occupiedCells = Object.keys(gameState.board).length;
            
            // Если все видимые клетки заняты, считаем ничью
            return occupiedCells >= totalCells;
        }

        // Обновление границ поля при необходимости
        function updateBoardBounds(x, y) {
            if (x < gameState.minX) gameState.minX = x - 1;
            if (x > gameState.maxX) gameState.maxX = x + 1;
            if (y < gameState.minY) gameState.minY = y - 1;
            if (y > gameState.maxY) gameState.maxY = y + 1;
        }

        // Обработчики событий
        resetBtn.addEventListener('click', initGame);
        botMoveBtn.addEventListener('click', () => {
            if (!gameState.gameOver && gameState.currentPlayer === 'o') {
                makeBotMove();
            }
        });

        // Запуск игры при загрузке страницы
        window.addEventListener('load', initGame);
    </script>
</body>
</html>